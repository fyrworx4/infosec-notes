# lateral movement

Executed various commands on reverse shell to look for other targets on network.

Check ARP Table:

```bash
arp -a
```

output:
```
sh-4.4# arp -a
arp -a
ip-10-200-187-1.eu-west-1.compute.internal (10.200.187.1) at 02:31:88:4f:0c:ed [ether] on eth0
ip-10-200-187-150.eu-west-1.compute.internal (10.200.187.150) at 02:16:6c:8e:9d:0d [ether] on eth0
ip-10-200-187-100.eu-west-1.compute.internal (10.200.187.100) at 02:13:40:67:5d:6d [ether] on eth0
ip-10-200-187-250.eu-west-1.compute.internal (10.200.187.250) at 02:c7:1d:c0:02:7b [ether] on eth0
```

Check /etc/hosts file:

```bash
cat /etc/hosts
```

output:
```
sh-4.4# cat /etc/hosts
cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
```

Check /etc/resolv.conf file:

```bash
cat /etc/resolv.conf
```

output:
```
sh-4.4# cat /etc/resolv.conf
cat /etc/resolv.conf
# Generated by NetworkManager
search eu-west-1.compute.internal
nameserver 10.200.0.2
```

Bash one-liner for ping sweep:

```bash
for i in {1..255}; do (ping -c 1 10.200.187.${i} | grep "bytes from" &); done
```

Output:

```
sh-4.4# for i in {1..255}; do (ping -c 1 10.200.187.${i} | grep "bytes from" &); done
<g -c 1 10.200.187.${i} | grep "bytes from" &); done
64 bytes from 10.200.187.1: icmp_seq=1 ttl=255 time=0.271 ms
64 bytes from 10.200.187.200: icmp_seq=1 ttl=64 time=0.053 ms
64 bytes from 10.200.187.250: icmp_seq=1 ttl=64 time=0.452 ms
```

Summary:
* 3 new IPs: .100, .150, .250
* DNS server: 10.200.0.2
* Pingable hosts: .1, .200, .250
* Actual hosts: .100, .150
  - .1 and .250 are for the router and OpenVPN server, respectively

Downloaded nmap binary, transfered it to webserver using python http.server.

Ran nmap on webserver to enumerate internal network:

```bash
./nmap-fyr -sn 10.200.187.1-255 -oN scan-fyr
```

Output:

```
sh-4.4# ./nmap-fyr -sn 10.200.187.1-255 -oN scan-fyr
./nmap-fyr -sn 10.200.187.1-255 -oN scan-fyr

Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2021-08-16 23:40 BST
Cannot find nmap-payloads. UDP payloads are disabled.
Nmap scan report for ip-10-200-187-1.eu-west-1.compute.internal (10.200.187.1)
Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed
Host is up (0.00025s latency).
MAC Address: 02:31:88:4F:0C:ED (Unknown)
Nmap scan report for ip-10-200-187-100.eu-west-1.compute.internal (10.200.187.100)
Host is up (0.00016s latency).
MAC Address: 02:13:40:67:5D:6D (Unknown)
Nmap scan report for ip-10-200-187-150.eu-west-1.compute.internal (10.200.187.150)
Host is up (-0.10s latency).
MAC Address: 02:16:6C:8E:9D:0D (Unknown)
Nmap scan report for ip-10-200-187-250.eu-west-1.compute.internal (10.200.187.250)
Host is up (0.00017s latency).
MAC Address: 02:C7:1D:C0:02:7B (Unknown)
Nmap scan report for ip-10-200-187-200.eu-west-1.compute.internal (10.200.187.200)
Host is up.
Nmap done: 255 IP addresses (5 hosts up) scanned in 3.73 seconds
```

Further nmap scans:

```bash
./nmap-fyr 10.200.187.100,150 -p 1-15000
```

Output:

```
sh-4.4# ./nmap-fyr 10.200.187.100,150 -p 1-15000
./nmap-fyr 10.200.187.100,150 -p 1-15000

Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2021-08-17 00:28 BST
Unable to find nmap-services!  Resorting to /etc/services
Cannot find nmap-payloads. UDP payloads are disabled.
Nmap scan report for ip-10-200-187-100.eu-west-1.compute.internal (10.200.187.100)
Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed
Host is up (-0.20s latency).
All 15000 scanned ports on ip-10-200-187-100.eu-west-1.compute.internal (10.200.187.100) are filtered
MAC Address: 02:13:40:67:5D:6D (Unknown)

Nmap scan report for ip-10-200-187-150.eu-west-1.compute.internal (10.200.187.150)
Host is up (0.00052s latency).
Not shown: 14997 filtered ports
PORT     STATE SERVICE
80/tcp   open  http
3389/tcp open  ms-wbt-server
5985/tcp open  wsman
MAC Address: 02:16:6C:8E:9D:0D (Unknown)

Nmap done: 2 IP addresses (2 hosts up) scanned in 329.20 seconds
sh-4.4#
```

Use sshuttle to perform lateral movement via VPN:

```bash
sshuttle -r root@10.200.187.200 --ssh-cmd "ssh -i id_rsa" 10.200.187.0/24 -x 10.200.187.200
```
